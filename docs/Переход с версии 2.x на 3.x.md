## Обязательные изменения

### FSM

FSM начал хранить словари как данные. Подробнее об изменившихся функциях в [FSM](FSM).

#### Пример кода бота с формой на 2.x (Устаревший)

```py
@bot.on_message(aiomax.filters.state('name'))
async def write_name(message: aiomax.Message, cursor: fsm.FSMCursor):
    await message.reply("Напишите свою фамилию")
    cursor.change_state('surname')
    cursor.change_data(message.content) # В данных хранится только одно значение

@bot.on_message(aiomax.filters.state('surname'))
async def write_surname(message: aiomax.Message, cursor: fsm.FSMCursor):
    name = cursor.get_data()
    surname = message.content

    await message.reply(f"Здравствуйте, {name} {surname}")
    cursor.clear()
```

#### Пример кода бота с формой на 3.x

```py
@bot.on_message(aiomax.filters.state('name'))
async def write_name(message: aiomax.Message, cursor: fsm.FSMCursor):
    await message.reply("Напишите свою фамилию")
    cursor.change_state('surname')
    cursor.update_data(name=message.content) # В данных может хранится несколько значений. Соответственно, можно без проблем добавлять отчество
    # Также можно написать `cursor.update_data({"name": message.content})`, или cursor.set_data с этими значениями, тк данные задаются впервые

@bot.on_message(aiomax.filters.state('surname'))
async def write_surname(message: aiomax.Message, cursor: fsm.FSMCursor):
    name = cursor.get_data('name')
    # либо name = cursor.get_data()['name']
    surname = message.content

    await message.reply(f"Здравствуйте, {name} {surname}")
    cursor.clear() # очистка данных и состояния одновременно осталась прежней
```

### Фильтры

Названия фильтров начали писаться в `PascalCase` с суффиксом `Filter`. Например:

- `StateFilter` вместо `state`
- `StartsWithFilter` вместо `startswith`
- `PapayaFilter` вместо `papaya`

> [!IMPORTANT]
> В отличие от старого фильтра `papaya`, `PapayaFilter` должен вызываться как все остальные фильтры (если он вам зачем-то понадобился)

## Прочие изменения

### Автоматическая синхронизация команд

В класс `Bot` добавлена функция `sync_commands` для автоматической синхронизации команд с сервером.

Все синхронизированные команды будут отображаться в приложении при вводе `/` в поле ввода сообщения.

`Bot.sync_commands` синхронизирует все команды с сервером, добавленные через декоратор `on_command`, и у которых указан `description`.

При создании бота можно изменить параметр `autosync_commands` (по умолчанию `True`). Если этот параметр `True`, то при запуске бота функция `sync_commands` вызовется автоматически.

> [!NOTE]
> До этого изменения синхронизировать команды с сервером можно было только используя `Bot.patch_me` с указанным параметром `commands`.
