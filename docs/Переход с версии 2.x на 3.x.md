## Обязательно к изменению

### FSM

FSM начал хранить словари как данные. Подробнее об изменившихся функциях в [FSM](FSM).

#### Пример бота с формой на 2.x (Устаревший)

```py
@bot.on_message(aiomax.filters.state('name'))
async def write_name(message: aiomax.Message, cursor: fsm.FSMCursor):
    await message.reply("Напишите свою фамилию")
    cursor.change_state('surname')
    cursor.change_data(message.content) # В данных хранится только одно значение

@bot.on_message(aiomax.filters.state('surname'))
async def write_surname(message: aiomax.Message, cursor: fsm.FSMCursor):
    name = cursor.get_data()
    surname = message.content

    await message.reply(f"Здравствуйте, {name} {surname}")
    cursor.clear()
```

#### Пример бота с формой на 3.x

```py
@bot.on_message(aiomax.filters.state('name'))
async def write_name(message: aiomax.Message, cursor: fsm.FSMCursor):
    await message.reply("Напишите свою фамилию")
    cursor.change_state('surname')
    cursor.update_data(name=message.content) # В данных может хранится несколько значений. Соответственно, можно без проблем добавлять отчество
    # Также можно написать `cursor.update_data({"name": message.content})`, или cursor.set_data с этими значениями, тк данные задаются впервые

@bot.on_message(aiomax.filters.state('surname'))
async def write_surname(message: aiomax.Message, cursor: fsm.FSMCursor):
    name = cursor.get_data('name')
    # либо name = cursor.get_data()['name']
    surname = message.content

    await message.reply(f"Здравствуйте, {name} {surname}")
    cursor.clear() # очистка данных и состояния одновременно осталась прежней
```

### Фильтры

Названия фильтров начали писаться в `PascalCase` с суффиксом `Filter`. Например:

- `StateFilter` вместо `state`
- `StartsWithFilter` вместо `startswith`
- `PapayaFilter` вместо `papaya`

> [!IMPORTANT]
> В отличие от старого фильтра `papaya`, `PapayaFilter` должен вызываться как все остальные фильтры (если он вам зачем-то понадобился)

## Прочие изменения

### Автоматическая синхронизация команд

В класс `Bot` добавлена функция `sync_commands`, которая изменяет команды, отображаемые в приложении, на добавленные через декоратор `on_command` с указанным параметром `description`.

При начале поллинга через `Bot.start_polling()` или `Bot.run()` можно добваить параметр `autosync_commands` (по умолчанию `True`). Если этот параметр `True`, то при начале поллинга функция `sync_commands` вызовется автоматически.

> [!NOTE]
> Помимо этого способа, изменять команды, отображаемые в приложении, можно через вызов `Bot.patch_me` с параметром `commands`.

### Фильтр логического НЕ

В `BaseFilter` (родительский объект всех встроенных фильтров) добавлен оператор минус (`-`) для отрицания фильтров. Пример:

```py
@bot.on_message(-aiomax.filters.startswith('aiomax'))
async def notaiomax(message: aiomax.Message):
    pass
```

Этот фильтр проверяет, чтобы сообщение **не** начиналось на "aiomax"

### Прочее

- Появилась поддержка асинхронных фильтров

- Появилась поддержка фильтров команд
