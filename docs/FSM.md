Фреймворк aiomax имеет встроенные конечные автоматы.

Конечные автоматы помогают создавать формы (опросы) и передавать данные пользователей между функциями

Пример бота, использующего FSM, можете посмотреть на странице [Примеры](Примеры)

FSM имеет 2 понятия:

- `State` - состояние пользователя. Например, что должно содержать сообщение, которое от него ожидается

- `Data` - данные пользователя, передающиеся между функциями. Начиная с версии [`3.0.0`](<Переход с версии 2.x на 3.x>) может хранить в себе только словарь (`dict`)

Для работы с FSM используются 2 класса: `FSMStorage` и `FSMCursor`

## `FSMStorage()`

Хранилище данных. Создается своё для каждого бота

### `FSMStorage.get_state(user_id) -> Any`

Возвращает текущее состояние пользователя. `None`, если пользователя нет в хранилище

### `FSMStorage.get_data(user_id, key) -> any | dict`

Возвращает текущие данные пользователя. `None`, если пользователя нет в хранилище

Если передан параметр `key`, возвращает значение данных по этому ключу (т. е. `FSMStorage.get_data()['key']` равен `FSMStorage.get_data('key')`)

### `FSMStorage.change_state(user_id, new)`

Изменяет состояние пользователя на новое (`new`)

### `FSMStorage.update_data(user_id, data: dict, **kwdata)`

Добавляет данные в словарь пользователя по ключу. Изменит данные, если по такому ключу уже что-то хранится. Они могут быть переданы в аргумент data как словарь, либо как именованные аргументы

### `FSMStorage.set_data(user_id, data: dict, **kwdata)`

Заменяет данные пользователя новыми. Они могут быть указаны как `data` (ввиде словаря), либо как именованные аргументы (кварги, kwargs)

### `FSMStorage.clear_state(user_id) -> Any`

Очищает состояние пользователя и возвращает старое значение

### `FSMStorage.clear_data(user_id) -> dict`

Очищает данные пользователя и возвращает старый словарь

### `FSMStorage.clear(user_id) -> None`

Очищает состояние и данные пользователя

## `FSMCursor(user_id)`

Имеет все те же функции, что и `FSMStorage`, но не имеет параметра `user_id` в них. Оперирует только над одним пользователем

Передается во всех [декораторах](Декораторы), кроме `on_button_chat_create` и `on_exception`, как именованный аргумент `cursor` с идентификатором пользователя, совершившего действие
